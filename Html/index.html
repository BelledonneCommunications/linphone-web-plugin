<html>
<head>
<title>test page for object fbcontrol</title>
<link type="text/css" href="css/ui-lightness/jquery-ui-1.8.17.custom.css" rel="stylesheet" />
<link type="text/css" href="css/linphone.css" rel="stylesheet" />
<script type="text/javascript" src="js/jquery-1.7.1.min.js"></script>
<script type="text/javascript" src="js/jquery-ui-1.8.17.custom.min.js"></script>
<!--<script type="text/javascript" src="js/ui.tabs.closable.min.js"></script>  -->
<script type="text/javascript" src="js/jquery.scrollabletab.js"></script>
<script type="text/javascript" src="js/linphone.js"></script>
</head>
<script type="text/javascript">
	function plugin0() {
		return document.getElementById('plugin0');
	}
	plugin = plugin0;
	function addEvent(obj, name, func) {
		if (window.addEventListener) {
			obj.addEventListener(name, func, false);
		} else {
			obj.attachEvent("on" + name, func);
		}
	}

	function load() {

	}

	function addLog(message) {
		jQuery('#log').val(jQuery('#log').val() + message + '\n');
	}

	function pluginLoaded() {
		jQuery('#version_number').text(plugin().version);
		addEvent(plugin(), 'global_state_changed', global_state_changed);
		addEvent(plugin(), 'call_state_changed', call_state_changed);
		addEvent(plugin(), 'display_status', display_status);
		addEvent(plugin(), 'display_message', display_message);
		addEvent(plugin(), 'display_warning', display_warning);
		addEvent(plugin(), 'display_url', display_url);
		if (plugin().init() != 0) {
			alert("Plugin error!");
		}
	}

	function global_state_changed(state, message) {
		addLog('State(' + state + '): ' + message);
		jQuery('.linphone .window .status .text').text(
				LinphoneGlobalStateText[state])
	}

	function call_state_changed(call, state, message) {
		addLog('Call(' + state + '): ' + message);
		var element = findCallTab(call);
		if(element) {
			element.text(LinphoneCallStateText[state])	
		} else {
			addLog('Can\'t find call tab' + call);
		}
	}

	//registration_state_changed(LinphoneProxyConfig *cfg, LinphoneRegistrationState cstate, const char *message);
	//call_state_changed(LinphoneCall *call, LinphoneCallState cstate, const char *message);
	//notify_presence_recv(LinphoneFriend * lf);
	//new_subscription_request(LinphoneFriend *lf, const char *url);
	//auth_info_requested(const char *realm, const char *username);
	//call_log_updated(LinphoneCallLog *newcl);
	//text_received(LinphoneChatRoom *room, const LinphoneAddress *from, const char *message);
	//dtmf_received(LinphoneCall *call, int dtmf);
	//refer_received(const char *refer_to);
	//buddy_info_updated(LinphoneFriend *lf);
	//notify_recv(LinphoneCall *call, const char *from, const char *event);
	function display_status(message) {
		addLog('Status: ' + message);
	}

	function display_message(message) {
		addLog('Message: ' + message);
	}

	function display_warning(message) {
		addLog('Warning: ' + message);
	}

	function display_url(message, url) {
		addLog('Url: ' + message + ' - ' + url);
	}

	function findCallTab(obj) {
		var ret = null
		jQuery('#linphone .window .tabs .tab').each(function (index) {
			var element = jQuery(this)
			if(element.data('call') == obj) {
				ret = element;
			}
		})
		return ret;
	}
	
	jQuery(function() {
		var call_number = 1;
		// Tabs
		jQuery('.linphone .window .tabs').tabs({closable: true, scrollable: true})
		jQuery('.linphone .window .composer .dial_button').click(
				function(event) {
					obj = plugin().invite(jQuery(event.target).parent().find('.dest').val())
					console.log(obj)
					if (obj) {
						console.log('Add tab call-' + call_number)
						var data = jQuery(
								'<div id="call-'+call_number+'" class="tab"></div>')
								.append("<b>Test</b>");
						jQuery('#linphone .window .tabs').append(data).tabs(
								'add', '#call-' + call_number,
								'Call ' + call_number);
						jQuery('#linphone .window .tabs').tabs('select', '#call-' + call_number)
						jQuery('#linphone .window .tabs #call-'+call_number).data('call', obj)
						call_number++
					}
				})

	})
	//show(LinphoneCore *lc);
	//call_encryption_changed(LinphoneCall *call, bool_t on, const char *authentication_token);
</script>
<style type="text/css">
body {
	font: 62.5% "Trebuchet MS", sans-serif;
}
.tabs {
    font-size: .8em !important;
	width:auto;
	margin:5px;
	padding:0;
	border:0 !important;
	overflow:hidden;
}

/*scrollable tabs css*/
.ui-scrollable-tabs { overflow:hidden; position:relative; }

.ui-scrollable-tabs .ui-tabs-nav {
	width:1000000px;
	padding:1px 0 0 1px;
	border-left:none;
	border-right:none;
	padding-top:1px;
	position:relative;
}

.ui-scrollable-tabs .ui-tabs .ui-tabs-closable li a {
	padding-right:5px;
}

.ui-scrollable-tabs .ui-tabs-nav-arrows {
	left: 0;
	margin: 0;
	margin:0 5px;
	padding: 0;
	position: absolute;
	right: 0;
	top: 5px;
	height: 25px;
}

/*IE7 fix*/
*:first-child+html .ui-scrollable-tabs .ui-tabs-nav-arrows {
	z-index:1;
}

.ui-scrollable-tabs .ui-tabs .ui-tabs-nav li {
	margin:0 1px 0;
}

.ui-tabs-nav li .ui-tabs-close {
	float:left;
	margin-top:3px;
	margin-right:4px;
	border:none;
	cursor:pointer;
}

.ui-scrollable-tabs .ui-tabs-nav-arrows .ui-tabs-arrow-next { float:right; }

.ui-scrollable-tabs .ui-tabs-nav-arrows .ui-tabs-arrow-previous { float:left; }

.ui-scrollable-tabs .ui-tabs-nav-arrows li {
    list-style:none;
    position:relative;
    cursor:pointer;
    margin:0;
    padding:0;
	display:none;
	z-index:1;
	height: 23px;
}

.ui-scrollable-tabs .ui-tabs-nav-arrows li a {
    display: block;
	margin-top: 3px;
}

.ui-scrollable-tabs .ui-tabs-nav-arrows li a:focus {
	outline: 0px;
}

/*End of scrollable tabs css*/
#version {
	font-size: 9px;
}

#version_number {
	font-weight: bold;
}
</style>
<body onload="load()">
	<object id="plugin0" type="application/x-linphone" width="0" height="0">
		<param name="onload" value="pluginLoaded" />
	</object>
	<br />

	<div class="linphone ui-widget" id="linphone">
		<div class="window ui-corner-all">
			<div class="header ui-corner-top">
				<div class="text">Linphone</div>
			</div>
			
			<div class="composer">
				<div style="display: inline-block;">
					<input type="text" class="dest" />
				</div>
				<div class="dial_button"></div>
			</div>
			
			<div class="tabs">
				<ul>
					<li><a href="#tabs-1">First</a></li>
				</ul>
				<div id="tabs-1" class="tab">Example</div>
			</div>
			
			<div class="status ui-corner-bottom">
				<div class="text"></div>
			</div>
		</div>
	</div>

	<br />
	<br />

	<div>
		<textarea id="log" rows="10" cols="100"></textarea>
		<div class="ui-widget">
			<div id="version" class="ui-state-highlight ui-corner-all">
				Linphone version: <span id="version_number"></span>
			</div>
		</div>
	</div>
</body>
</html>

<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
	<Product Id="*" Name="${FBSTRING_PluginName}" Language="1033" Version="${FBSTRING_PLUGIN_VERSION}" Manufacturer="${FBSTRING_CompanyName}" UpgradeCode="{${FBControl_WixUpgradeCode_GUID}}">
		<Package InstallerVersion="200" Compressed="yes" Description="Installer for the ${FBSTRING_PluginName} plugin" InstallScope="${WIX_INSTALL_SCOPE}" />
		<Upgrade Id="{${FBControl_WixUpgradeCode_GUID}}">
			<UpgradeVersion
				Property="OLD_VERSION_FOUND"
				Minimum="0.0.1" IncludeMinimum="yes"
				Maximum="${FBSTRING_PLUGIN_VERSION}" IncludeMaximum="yes"
				OnlyDetect="no" IgnoreRemoveFailure="yes"
				MigrateFeatures="yes" />
		</Upgrade>
		<Property Id="MSIRESTARTMANAGERCONTROL" Value="Disable" />
		<InstallExecuteSequence>
			<RemoveExistingProducts After="InstallInitialize" />
			<InstallExecute After="RemoveExistingProducts" />
		</InstallExecuteSequence>
		<Media Id="1" Cabinet="${PLUGIN_PREFIX}.cab" EmbedCab="yes" />
		<Icon Id="linphone.ico" SourceFile="${CMAKE_CURRENT_SOURCE_DIR}/Win/WiX/linphone.ico"/>
		<Property Id="ARPPRODUCTICON" Value="linphone.ico" />

		<Directory Id="TARGETDIR" Name="SourceDir">
			<Directory Id="${FB_WIX_INSTALL_LOCATION}">
				<Directory Id="CompanyDir" Name="${FBSTRING_CompanyDomain}">
					<Component Id="CompanyDirComp" Guid="*">
						<RemoveFolder Id="RemoveCompanyDir" On="uninstall" />
						<RegistryValue
							Root="${REGKEY_ROOT}"
							Key="SOFTWARE\${FBSTRING_CompanyDomain}"
							Name="Uninstall"
							Type="string"
							Value="${FBSTRING_PLUGIN_VERSION}"
							KeyPath="yes" />
					</Component>
					<Directory Id="PluginNameDir" Name="${FBSTRING_PluginDomain}">
						<Component Id="PluginNameDirComp" Guid="*">
							<RemoveFolder Id="RemovePluginNameDir" On="uninstall" />
							<RegistryValue
								Root="${REGKEY_ROOT}"
								Key="SOFTWARE\${FBSTRING_CompanyDomain}\${FBSTRING_PluginDomain}"
								Name="Uninstall"
								Type="string"
								Value="${FBSTRING_PLUGIN_VERSION}"
								KeyPath="yes" />
						</Component>
						<Directory Id="INSTALLDIR" Name="${FBSTRING_PLUGIN_VERSION}">
							<Component Id="InstallDirComp" Guid="*">
								<RemoveFolder Id="RemoveInstallDir" On="uninstall" />
								<RegistryValue
									Root="${REGKEY_ROOT}"
									Key="SOFTWARE\${FBSTRING_CompanyDomain}\${FBSTRING_PluginDomain}\${FBSTRING_PLUGIN_VERSION}"
									Name="Uninstall"
									Type="string"
									Value="${FBSTRING_PLUGIN_VERSION}"
									KeyPath="yes" />
							</Component>


							<Component Id="MainLibraries" Guid="d540fc92-55c6-4477-a481-c9dc7bb8dc6a">
								<?if $(var.Configuration) = Debug ?>
								  <File Id="nplinphone_web_pdb" Source="$(var.BINSRC)/${FBSTRING_PluginFileName}.pdb" />
								<?endif ?>
								<File Id="liblinphone" Source="$(var.BINSRC)/liblinphone.dll" />
								<?if $(var.Configuration) = Debug ?>
								  <File Id="liblinphone_pdb" Source="$(var.BINSRC)/liblinphone.pdb" />
								<?endif ?>
								<File Id="libmediastreamer_base" Source="$(var.BINSRC)/libmediastreamer_base.dll" />
								<?if $(var.Configuration) = Debug ?>
								  <File Id="libmediastreamer_base_pdb" Source="$(var.BINSRC)/libmediastreamer_base.pdb" />
								<?endif ?>
								<File Id="libmediastreamer_voip" Source="$(var.BINSRC)/libmediastreamer_voip.dll" />
								<?if $(var.Configuration) = Debug ?>
								  <File Id="libmediastreamer_voip_pdb" Source="$(var.BINSRC)/libmediastreamer_voip.pdb" />
								<?endif ?>
								<File Id="libopus" Source="$(var.BINSRC)/libopus-0.dll" />
								<File Id="libortp" Source="$(var.BINSRC)/libortp.dll" />
								<?if $(var.Configuration) = Debug ?>
								  <File Id="libortp_pdb" Source="$(var.BINSRC)/libortp.pdb" />
								<?endif ?>
								<File Id="libspeex" Source="$(var.BINSRC)/libspeex.dll" />
								<?if $(var.Configuration) = Debug ?>
								  <File Id="libspeex_pdb" Source="$(var.BINSRC)/libspeex.pdb" />
								<?endif ?>
								<File Id="libspeexdsp" Source="$(var.BINSRC)/libspeexdsp.dll" />
								<?if $(var.Configuration) = Debug ?>
								  <File Id="libspeexdsp_pdb" Source="$(var.BINSRC)/libspeexdsp.pdb" />
								<?endif ?>
								<File Id="libvpx" Source="$(var.BINSRC)/libvpx-1.dll" />
								${IF LW_USE_EXOSIP}
								<File Id="libexosip2" Source="$(var.BINSRC)/libexosip2-7.dll" />
								<File Id="libosip2" Source="$(var.BINSRC)/libosip2-7.dll" />
								<File Id="libosipparser2" Source="$(var.BINSRC)/libosipparser2-7.dll" />
								${ENDIF}
								${IF LW_USE_SRTP}
								<File Id="libsrtp" Source="$(var.BINSRC)/libsrtp-1.4.5.dll" />
								${ENDIF}
								${IF LW_USE_FFMPEG}
								<File Id="avcodec" Source="$(var.BINSRC)/avcodec-53.dll" />
								<File Id="avutil" Source="$(var.BINSRC)/avutil-51.dll" />
								<File Id="swscale" Source="$(var.BINSRC)/swscale-2.dll" />
								${ENDIF}
								${IF LW_USE_OPENSSL}
								<File Id="libeay32" Source="$(var.BINSRC)/libeay32.dll" />
								<File Id="ssleay32" Source="$(var.BINSRC)/ssleay32.dll" />
								${ENDIF}
								${IF LW_USE_POLARSSL}
								<File Id="libpolarssl" Source="$(var.BINSRC)/libpolarssl.dll" />
								<?if $(var.Configuration) = Debug ?>
								  <File Id="libpolarssl_pdb" Source="$(var.BINSRC)/libpolarssl.pdb" />
								<?endif ?>
								${ENDIF}
								${IF LW_USE_BELLESIP}
								<File Id="libbellesip" Source="$(var.BINSRC)/libbellesip.dll" />
								<?if $(var.Configuration) = Debug ?>
								  <File Id="libbellesip_pdb" Source="$(var.BINSRC)/libbellesip.pdb" />
								<?endif ?>
								<File Id="libantlr3c" Source="$(var.BINSRC)/libantlr3c.dll" />
								<?if $(var.Configuration) = Debug ?>
								  <File Id="libantlr3c_pdb" Source="$(var.BINSRC)/libantlr3c.pdb" />
								<?endif ?>
								<File Id="libxml2" Source="$(var.BINSRC)/libxml2.dll" />
								<?if $(var.Configuration) = Debug ?>
								  <File Id="libxml2_pdb" Source="$(var.BINSRC)/libxml2.pdb" />
								<?endif ?>
								${ENDIF}
								<RegistryValue
									Root="${REGKEY_ROOT}"
									Key="SOFTWARE\${FBSTRING_CompanyDomain}\${FBSTRING_PluginDomain}\${FBSTRING_PLUGIN_VERSION}\MainLibraries"
									Name="Uninstall"
									Type="string"
									Value="${FBSTRING_PLUGIN_VERSION}"
									KeyPath="yes" />
							</Component>
							<Directory Id="LinphoneWebDir" Name="${PLUGIN_SHAREDIR}">
								<Component Id="LinphoneWebDirComp" Guid="*">
									<RemoveFolder Id="RemoveLinphoneWebDir" On="uninstall" />
									<RegistryValue
										Root="${REGKEY_ROOT}"
										Key="SOFTWARE\${FBSTRING_CompanyDomain}\${FBSTRING_PluginDomain}\${FBSTRING_PLUGIN_VERSION}\LinphoneWebDirComp"
										Name="Uninstall"
										Type="string"
										Value="${FBSTRING_PLUGIN_VERSION}"
										KeyPath="yes" />
								</Component>
								<Directory Id="LibDir" Name="lib">
									<Component Id="LibDirComp" Guid="*">
										<RemoveFolder Id="RemoveLibDir" On="uninstall" />
										<RegistryValue
											Root="${REGKEY_ROOT}"
											Key="SOFTWARE\${FBSTRING_CompanyDomain}\${FBSTRING_PluginDomain}\${FBSTRING_PLUGIN_VERSION}\LibDirComp"
											Name="Uninstall"
											Type="string"
											Value="${FBSTRING_PLUGIN_VERSION}"
											KeyPath="yes" />
									</Component>
									<Directory Id="LibMediastreamerDir" Name="mediastreamer">
										<Component Id="LibMediastreamerDirComp" Guid="d540fc92-55c6-4477-a481-c9dc7bb8dc70">
											<RemoveFolder Id="RemoveLibMediastreamerDir" On="uninstall" />
											<RegistryValue
												Root="${REGKEY_ROOT}"
												Key="SOFTWARE\${FBSTRING_CompanyDomain}\${FBSTRING_PluginDomain}\${FBSTRING_PLUGIN_VERSION}\LibMediastreamerDirComp"
												Name="Uninstall"
												Type="string"
												Value="${FBSTRING_PLUGIN_VERSION}"
												KeyPath="yes" />
										</Component>
										<Directory Id="MsPluginsDir" Name="plugins">
											<Component Id="MsPluginsDirComp" Guid="d540fc92-55c6-4477-a481-c9dc7bb8dc71">
												<RemoveFolder Id="RemoveMsPluginsDir" On="uninstall" />
												${IF LW_USE_G729}
												<File Id="libmsbcg729" Source="$(var.BINSRC)/${PLUGIN_SHAREDIR}/lib/mediastreamer/plugins/libmsbcg729-0.dll" />
												${ENDIF}
												${IF LW_USE_X264}
												<File Id="libmsx264" Source="$(var.BINSRC)/${PLUGIN_SHAREDIR}/lib/mediastreamer/plugins/libmsx264-0.dll" />
												${ENDIF}
												<RegistryValue
													Root="${REGKEY_ROOT}"
													Key="SOFTWARE\${FBSTRING_CompanyDomain}\${FBSTRING_PluginDomain}\${FBSTRING_PLUGIN_VERSION}\MsPluginsDirComp"
													Name="Uninstall"
													Type="string"
													Value="${FBSTRING_PLUGIN_VERSION}"
													KeyPath="yes" />
											</Component>
										</Directory>
									</Directory>
								</Directory>
								<Directory Id="ShareDir" Name="share">
									<Component Id="ShareDirComp" Guid="*">
										<RemoveFolder Id="RemoveShareDir" On="uninstall" />
										<RegistryValue
											Root="${REGKEY_ROOT}"
											Key="SOFTWARE\${FBSTRING_CompanyDomain}\${FBSTRING_PluginDomain}\${FBSTRING_PLUGIN_VERSION}\ShareDirComp"
											Name="Uninstall"
											Type="string"
											Value="${FBSTRING_PLUGIN_VERSION}"
											KeyPath="yes" />
									</Component>
									<Directory Id="ShareLinphoneDir" Name="linphone">
										<Component Id="ShareLinphoneDirComp" Guid="d540fc92-55c6-4477-a481-c9dc7bb8dc6f">
											<RemoveFolder Id="RemoveShareLinphoneDir" On="uninstall" />
											<File Id="rootca" Source="$(var.BINSRC)/${PLUGIN_SHAREDIR}/share/linphone/rootca.pem" />
											<RegistryValue
												Root="${REGKEY_ROOT}"
												Key="SOFTWARE\${FBSTRING_CompanyDomain}\${FBSTRING_PluginDomain}\${FBSTRING_PLUGIN_VERSION}\ShareLinphoneDirComp"
												Name="Uninstall"
												Type="string"
												Value="${FBSTRING_PLUGIN_VERSION}"
												KeyPath="yes" />
										</Component>
									</Directory>
									<Directory Id="ShareImagesDir" Name="images">
										<Component Id="ShareImagesDirComp" Guid="d540fc92-55c6-4477-a481-c9dc7bb8dc6e">
											<RemoveFolder Id="RemoveShareImagesDir" On="uninstall" />
											<File Id="nowebcamCIF" Source="$(var.BINSRC)/${PLUGIN_SHAREDIR}/share/images/nowebcamCIF.jpg" />
											<RegistryValue
												Root="${REGKEY_ROOT}"
												Key="SOFTWARE\${FBSTRING_CompanyDomain}\${FBSTRING_PluginDomain}\${FBSTRING_PLUGIN_VERSION}\ShareImagesDirComp"
												Name="Uninstall"
												Type="string"
												Value="${FBSTRING_PLUGIN_VERSION}"
												KeyPath="yes" />
										</Component>
									</Directory>
									<Directory Id="ShareSoundsDir" Name="sounds">
										<Component Id="ShareSoundsDirComp" Guid="d540fc92-55c6-4477-a481-c9dc7bb8dc6d">
											<RemoveFolder Id="RemoveShareSoundsDir" On="uninstall" />
											<RegistryValue
												Root="${REGKEY_ROOT}"
												Key="SOFTWARE\${FBSTRING_CompanyDomain}\${FBSTRING_PluginDomain}\${FBSTRING_PLUGIN_VERSION}\ShareSoundsDirComp"
												Name="Uninstall"
												Type="string"
												Value="${FBSTRING_PLUGIN_VERSION}"
												KeyPath="yes" />
										</Component>
										<Directory Id="ShareSoundsLinphoneDir" Name="linphone">
											<Component Id="ShareSoundsLinphoneDirComp" Guid="d540fc92-55c6-4477-a481-c9dc7bb8dc6b">
												<RemoveFolder Id="RemoveShareSoundsLinphoneDir" On="uninstall" />
												<File Id="ringback" Source="$(var.BINSRC)/${PLUGIN_SHAREDIR}/share/sounds/linphone/ringback.wav" />
												<RegistryValue
													Root="${REGKEY_ROOT}"
													Key="SOFTWARE\${FBSTRING_CompanyDomain}\${FBSTRING_PluginDomain}\${FBSTRING_PLUGIN_VERSION}\ShareSoundsLinphoneDirComp"
													Name="Uninstall"
													Type="string"
													Value="${FBSTRING_PLUGIN_VERSION}"
													KeyPath="yes" />
											</Component>
											<Directory Id="ShareSoundsLinphoneRingsDir" Name="rings">
												<Component Id="ShareSoundsLinphoneRingsDirComp" Guid="d540fc92-55c6-4477-a481-c9dc7bb8dc6c">
													<RemoveFolder Id="RemoveShareSoundsLinphoneRingsDir" On="uninstall" />
													<File Id="oldphone" Source="$(var.BINSRC)/${PLUGIN_SHAREDIR}/share/sounds/linphone/rings/oldphone.wav" />
													<File Id="toymono" Source="$(var.BINSRC)/${PLUGIN_SHAREDIR}/share/sounds/linphone/rings/toy-mono.wav" />
													<RegistryValue
														Root="${REGKEY_ROOT}"
														Key="SOFTWARE\${FBSTRING_CompanyDomain}\${FBSTRING_PluginDomain}\${FBSTRING_PLUGIN_VERSION}\ShareSoundsLinphoneRingsDirComp"
														Name="Uninstall"
														Type="string"
														Value="${FBSTRING_PLUGIN_VERSION}"
														KeyPath="yes" />
												</Component>
											</Directory>
										</Directory>
									</Directory>
								</Directory>
							</Directory>
						</Directory>
					</Directory>
				</Directory>
			</Directory>
		</Directory>

		<Feature Id="MainPluginFeature" Title="${FBSTRING_PluginName}" Level="1">
			<ComponentRef Id="InstallDirComp"/>
			<ComponentRef Id="PluginNameDirComp"/>
			<ComponentRef Id="CompanyDirComp"/>
			<ComponentGroupRef Id="PluginDLLGroup"/>
			<ComponentRef Id="MainLibraries"/>
			<ComponentRef Id="LinphoneWebDirComp"/>
			<ComponentRef Id="LibDirComp"/>
			<ComponentRef Id="LibMediastreamerDirComp"/>
			<ComponentRef Id="MsPluginsDirComp"/>
			<ComponentRef Id="ShareDirComp"/>
			<ComponentRef Id="ShareLinphoneDirComp"/>
			<ComponentRef Id="ShareImagesDirComp"/>
			<ComponentRef Id="ShareSoundsDirComp"/>
			<ComponentRef Id="ShareSoundsLinphoneDirComp"/>
			<ComponentRef Id="ShareSoundsLinphoneRingsDirComp"/>
		</Feature>
	</Product>
</Wix>
